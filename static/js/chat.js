const loc=window.location
const uid=$('#uid');const file_target=loc.protocol+"//"+
loc.host+
loc.pathname.substring(0,9)+"file/upload/"+
JSON.parse($("#uid").text())+'/';const message_target=loc.protocol+"//"+
loc.host+
loc.pathname.substring(0,9)+
JSON.parse($("#uid").text())+"/";const responseImagePath=loc.protocol+"//"+loc.host;let msgInput=$("#id_message");let chatWrapper=$("#chat-items");$("#message_form").submit(function(e){e.preventDefault();let s=$("#message_form").find("input[name=csrfmiddlewaretoken]").val();let formData=new FormData()
formData.append("message",msgInput.val()),formData.append("csrfmiddlewaretoken",s);let t=new XMLHttpRequest();t.open("POST",message_target);t.send(formData)
t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let a=`<div class="d-flex align-items-baseline mb-3"><div><img src="${JSON.parse(t.responseText).profile_pic}.webp"alt="User Image"class="chat__icon"></div><div class="pe-2 my-auto"><div class="card d-inline-block p-2 px-3 m-2">${JSON.parse(t.responseText).message}</div></div></div>`;chatWrapper.append(a);$("#id_message").val("");}}});$("#attach-file-button").click(()=>{$("#id_file").trigger("click");});$("#id_file").change(()=>{$("#upload_form").trigger("submit");});$("#upload_form").submit((e)=>{e.preventDefault();let s=$("#upload_form").find("input[name=csrfmiddlewaretoken]").val();(formData=new FormData()).append("file",$("#id_file").prop("files")[0]),formData.append("csrfmiddlewaretoken",s);let t=new XMLHttpRequest();t.open("POST",file_target,!0),t.upload.addEventListener("progress",(e)=>{if(e.lengthComputable){let s=((e.loaded / e.total)*100)|0;$("#progress-div").css("display","block"),$(".file__upload-progress-line").css("width",s+"%"),$(".file__upload-progress-line").html(s+"%"),100===s&&setTimeout(()=>{$("#progress-div").css("display","none"),$("#upload_form").find('input[type="file"]').val("");},2e3);}}),t.send(formData),(t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let a=`<div class="d-flex align-items-baseline mb-3"><div><img src="${JSON.parse(t.responseText).profile_pic}.webp"alt="User Image"class="chat__icon"></div><div class="pe-2 my-auto"><div class="card d-inline-block p-2 px-3 m-2"><a href="${JSON.parse(t.responseText).link}"target="_blank"><i class="fas fa-file px-2"></i>${JSON.parse(t.responseText).fname}</a></div></div></div>`;chatWrapper.append(a);}});});$("#send-message-button").click(()=>{$("#send-message-hidden-button").click();});